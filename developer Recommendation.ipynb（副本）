{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":52},"executionInfo":{"elapsed":27053,"status":"ok","timestamp":1646793912578,"user":{"displayName":"来来","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"17514607166623592520"},"user_tz":-480},"id":"aEf24Xl8W-sa","outputId":"61dc165c-9aed-4cdd-9263-0287bc423632"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]},{"output_type":"execute_result","data":{"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"},"text/plain":["'/content/drive/MyDrive/Colab Notebooks/论文实验/graph_rec_benchmark1112'"]},"metadata":{},"execution_count":1}],"source":["from google.colab import drive  \n","drive.mount('/content/drive') \n","import os \n","os.chdir('/content/drive/MyDrive/Colab Notebooks/论文实验/graph_rec_benchmark1112') \n","os.getcwd()"]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":6303,"status":"ok","timestamp":1646793988176,"user":{"displayName":"来来","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"17514607166623592520"},"user_tz":-480},"id":"MnwnEslcop4S","outputId":"cc349f38-6b66-4f59-fac1-67c77de683d1"},"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting tensorboardX\n","  Downloading tensorboardX-2.5-py2.py3-none-any.whl (125 kB)\n","\u001b[K     |████████████████████████████████| 125 kB 8.2 MB/s \n","\u001b[?25hCollecting gensim==4.0.1\n","  Downloading gensim-4.0.1-cp37-cp37m-manylinux1_x86_64.whl (23.9 MB)\n","\u001b[K     |████████████████████████████████| 23.9 MB 1.4 MB/s \n","\u001b[?25hRequirement already satisfied: nltk in /usr/local/lib/python3.7/dist-packages (3.2.5)\n","Requirement already satisfied: scipy>=0.18.1 in /usr/local/lib/python3.7/dist-packages (from gensim==4.0.1) (1.4.1)\n","Requirement already satisfied: smart-open>=1.8.1 in /usr/local/lib/python3.7/dist-packages (from gensim==4.0.1) (5.2.1)\n","Requirement already satisfied: numpy>=1.11.3 in /usr/local/lib/python3.7/dist-packages (from gensim==4.0.1) (1.21.5)\n","Requirement already satisfied: protobuf>=3.8.0 in /usr/local/lib/python3.7/dist-packages (from tensorboardX) (3.17.3)\n","Requirement already satisfied: six in /usr/local/lib/python3.7/dist-packages (from tensorboardX) (1.15.0)\n","Installing collected packages: tensorboardX, gensim\n","  Attempting uninstall: gensim\n","    Found existing installation: gensim 3.6.0\n","    Uninstalling gensim-3.6.0:\n","      Successfully uninstalled gensim-3.6.0\n","Successfully installed gensim-4.0.1 tensorboardX-2.5\n"]}],"source":["!pip install  tensorboardX gensim==4.0.1 nltk "]},{"cell_type":"code","execution_count":3,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7582,"status":"ok","timestamp":1646793995754,"user":{"displayName":"来来","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"17514607166623592520"},"user_tz":-480},"id":"6Dc9XGEolldl","outputId":"2facf2cf-62ec-4ecd-86d2-77cbe157c50e"},"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in links: https://data.pyg.org/whl/torch-1.10.0+cu111.html\n","Collecting torch-scatter\n","  Downloading https://data.pyg.org/whl/torch-1.10.0%2Bcu113/torch_scatter-2.0.9-cp37-cp37m-linux_x86_64.whl (7.9 MB)\n","\u001b[K     |████████████████████████████████| 7.9 MB 7.0 MB/s \n","\u001b[?25hCollecting torch-sparse\n","  Downloading https://data.pyg.org/whl/torch-1.10.0%2Bcu113/torch_sparse-0.6.12-cp37-cp37m-linux_x86_64.whl (3.5 MB)\n","\u001b[K     |████████████████████████████████| 3.5 MB 15.4 MB/s \n","\u001b[?25hCollecting torch-cluster\n","  Downloading https://data.pyg.org/whl/torch-1.10.0%2Bcu113/torch_cluster-1.5.9-cp37-cp37m-linux_x86_64.whl (2.3 MB)\n","\u001b[K     |████████████████████████████████| 2.3 MB 70.7 MB/s \n","\u001b[?25hCollecting torch-spline-conv\n","  Downloading https://data.pyg.org/whl/torch-1.10.0%2Bcu113/torch_spline_conv-1.2.1-cp37-cp37m-linux_x86_64.whl (747 kB)\n","\u001b[K     |████████████████████████████████| 747 kB 5.1 MB/s \n","\u001b[?25hCollecting torch-geometric\n","  Downloading torch_geometric-2.0.3.tar.gz (370 kB)\n","\u001b[K     |████████████████████████████████| 370 kB 9.1 MB/s \n","\u001b[?25hRequirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from torch-sparse) (1.4.1)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from torch-geometric) (1.21.5)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from torch-geometric) (4.63.0)\n","Requirement already satisfied: networkx in /usr/local/lib/python3.7/dist-packages (from torch-geometric) (2.6.3)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from torch-geometric) (1.0.2)\n","Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from torch-geometric) (2.23.0)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from torch-geometric) (1.3.5)\n","Collecting rdflib\n","  Downloading rdflib-6.1.1-py3-none-any.whl (482 kB)\n","\u001b[K     |████████████████████████████████| 482 kB 72.7 MB/s \n","\u001b[?25hRequirement already satisfied: googledrivedownloader in /usr/local/lib/python3.7/dist-packages (from torch-geometric) (0.4)\n","Requirement already satisfied: jinja2 in /usr/local/lib/python3.7/dist-packages (from torch-geometric) (2.11.3)\n","Requirement already satisfied: pyparsing in /usr/local/lib/python3.7/dist-packages (from torch-geometric) (3.0.7)\n","Collecting yacs\n","  Downloading yacs-0.1.8-py3-none-any.whl (14 kB)\n","Requirement already satisfied: PyYAML in /usr/local/lib/python3.7/dist-packages (from torch-geometric) (3.13)\n","Requirement already satisfied: MarkupSafe>=0.23 in /usr/local/lib/python3.7/dist-packages (from jinja2->torch-geometric) (2.0.1)\n","Requirement already satisfied: python-dateutil>=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas->torch-geometric) (2.8.2)\n","Requirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas->torch-geometric) (2018.9)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil>=2.7.3->pandas->torch-geometric) (1.15.0)\n","Requirement already satisfied: setuptools in /usr/local/lib/python3.7/dist-packages (from rdflib->torch-geometric) (57.4.0)\n","Requirement already satisfied: importlib-metadata in /usr/local/lib/python3.7/dist-packages (from rdflib->torch-geometric) (4.11.2)\n","Collecting isodate\n","  Downloading isodate-0.6.1-py2.py3-none-any.whl (41 kB)\n","\u001b[K     |████████████████████████████████| 41 kB 715 kB/s \n","\u001b[?25hRequirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata->rdflib->torch-geometric) (3.7.0)\n","Requirement already satisfied: typing-extensions>=3.6.4 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata->rdflib->torch-geometric) (3.10.0.2)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->torch-geometric) (2021.10.8)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->torch-geometric) (2.10)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->torch-geometric) (3.0.4)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->torch-geometric) (1.24.3)\n","Requirement already satisfied: joblib>=0.11 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->torch-geometric) (1.1.0)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->torch-geometric) (3.1.0)\n","Building wheels for collected packages: torch-geometric\n","  Building wheel for torch-geometric (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for torch-geometric: filename=torch_geometric-2.0.3-py3-none-any.whl size=581968 sha256=853021a32280584782e1ccf111964066c5a307b1ca2e7ac5d16285a53cc27970\n","  Stored in directory: /root/.cache/pip/wheels/c3/2a/58/87ce0508964d4def1aafb92750c4f3ac77038efd1b9a89dcf5\n","Successfully built torch-geometric\n","Installing collected packages: isodate, yacs, rdflib, torch-spline-conv, torch-sparse, torch-scatter, torch-geometric, torch-cluster\n","Successfully installed isodate-0.6.1 rdflib-6.1.1 torch-cluster-1.5.9 torch-geometric-2.0.3 torch-scatter-2.0.9 torch-sparse-0.6.12 torch-spline-conv-1.2.1 yacs-0.1.8\n"]}],"source":["!pip install torch-scatter torch-sparse torch-cluster torch-spline-conv torch-geometric -f https://data.pyg.org/whl/torch-1.10.0+cu111.html"]},{"cell_type":"code","execution_count":4,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1910,"status":"ok","timestamp":1646793997661,"user":{"displayName":"来来","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"17514607166623592520"},"user_tz":-480},"id":"Pki9eauQWk6g","outputId":"38d80f08-b5ad-4783-f881-0b3d06f9d65d"},"outputs":[{"output_type":"stream","name":"stdout","text":["[nltk_data] Downloading package stopwords to /root/nltk_data...\n","[nltk_data]   Unzipping corpora/stopwords.zip.\n","[nltk_data] Downloading package punkt to /root/nltk_data...\n","[nltk_data]   Unzipping tokenizers/punkt.zip.\n"]},{"output_type":"execute_result","data":{"text/plain":["True"]},"metadata":{},"execution_count":4}],"source":["import nltk\n","nltk.download('stopwords')\n","nltk.download('punkt')"]},{"cell_type":"code","execution_count":5,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":980900,"status":"ok","timestamp":1646794978555,"user":{"displayName":"来来","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"17514607166623592520"},"user_tz":-480},"id":"7-ltVvU6HHGg","outputId":"919f256e-aa92-45e1-8e8b-e42a4a3e8ecd"},"outputs":[{"output_type":"stream","name":"stdout","text":["dataset params: {'root': 'data/Tensorflow', 'dataset': 'Tensorflow', 'if_use_features': False, 'num_negative_samples': 6, 'num_core': 10, 'num_feat_core': 10, 'cf_loss_type': 'BPR', 'type': 'hete', 'sampling_strategy': 'random', 'ssl': False, 'side_info': True, 'side_info_vector_size': 64, 'side_info_window': 8, 'side_info_min_count': 3, 'side_info_epoch': 8, 'model': 'HGDR'}\n","task params: {'model_type': 'Graph', 'if_use_features': False, 'emb_dim': 64, 'hidden_size': 64, 'repr_dim': 16, 'dropout': 0.2, 'num_heads': 1, 'meta_path_steps': [2, 2, 2, 2, 2], 'channel_aggr': 'att', 'side_info': True, 'side_info_vector_size': 64, 'emb_cat': False, 'ssl': True, 'ssl_coff': 0.2, 'feat_drop': 0.2, 'tau': 0.5}\n","train params: {'init_eval': True, 'num_negative_samples': 6, 'num_neg_candidates': 99, 'opt': 'adam', 'runs': 2, 'epochs': 30, 'batch_size': 1024, 'weight_decay': 0.001, 'device': 'cuda:0', 'lr': 0.001, 'num_workers': 12, 'weights_folder': 'data/weights/Tensorflow/HGDR/BPR', 'logger_folder': 'data/loggers/Tensorflow/HGDR/BPR', 'save_epochs': [10, 20, 25], 'save_every_epoch': 10, 'metapath_test': True, 'head_tail_test': False}\n","No checkpoint_backup found at 'data/weights/Tensorflow/HGDR/BPR/run_2/lastest.pkl'\n","negative sampling\n","/usr/local/lib/python3.7/dist-packages/torch/utils/data/dataloader.py:481: UserWarning: This DataLoader will create 12 worker processes in total. Our suggested max number of worker in current system is 4, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.\n","  cpuset_checked))\n","Run: 2, epoch: 1, train loss: 226.8379: 100% 1412/1412 [03:30<00:00,  6.72it/s]\n","Run 2, epoch: 1, HR@5: 0.6432, HR@10: 0.8329, HR@15: 0.9119, HR@20: 0.9475, NDCG@5: 0.4463, NDCG@10: 0.5080, NDCG@15: 0.5290, NDCG@20: 0.5374, AUC: 0.9457, eval loss: 14.1809 : 100% 22369/22369 [02:19<00:00, 160.35it/s]\n","Run: 2, epoch: 1, HR@5: 0.6432, HR@10: 0.8329, HR@15: 0.9119, HR@20: 0.9475, NDCG@5: 0.4463, NDCG@10: 0.5080, NDCG@15: 0.5290, NDCG@20: 0.5374, AUC: 0.9457, train loss: 226.8379, eval loss: 14.1809 \n","\n","negative sampling\n","Run: 2, epoch: 2, train loss: 149.8215: 100% 1412/1412 [02:52<00:00,  8.16it/s]\n","Run 2, epoch: 2, HR@5: 0.7380, HR@10: 0.8855, HR@15: 0.9405, HR@20: 0.9638, NDCG@5: 0.5415, NDCG@10: 0.5897, NDCG@15: 0.6043, NDCG@20: 0.6099, AUC: 0.9588, eval loss: 11.4349 : 100% 22369/22369 [02:15<00:00, 165.29it/s]\n","Run: 2, epoch: 2, HR@5: 0.7380, HR@10: 0.8855, HR@15: 0.9405, HR@20: 0.9638, NDCG@5: 0.5415, NDCG@10: 0.5897, NDCG@15: 0.6043, NDCG@20: 0.6099, AUC: 0.9588, train loss: 149.8215, eval loss: 11.4349 \n","\n","negative sampling\n","Run: 2, epoch: 3, train loss: 126.4090: 100% 1412/1412 [02:53<00:00,  8.14it/s]\n","Run 2, epoch: 3, HR@5: 0.7600, HR@10: 0.8967, HR@15: 0.9452, HR@20: 0.9672, NDCG@5: 0.5645, NDCG@10: 0.6091, NDCG@15: 0.6220, NDCG@20: 0.6273, AUC: 0.9624, eval loss: 10.4346 :  87% 19519/22369 [01:54<00:16, 170.65it/s]\n","Traceback (most recent call last):\n","  File \"HGDR_solver.py\", line 150, in <module>\n","    solver.run()\n","  File \"/content/drive/MyDrive/Colab Notebooks/论文实验/graph_rec_benchmark1112/solver.py\", line 284, in run\n","    HRs, NDCGs, AUC, eval_loss = self.metrics(run, epoch, model, dataset)\n","  File \"/content/drive/MyDrive/Colab Notebooks/论文实验/graph_rec_benchmark1112/solver.py\", line 111, in metrics\n","    run, epoch, HRs.mean(axis=0)[0], HRs.mean(axis=0)[5], HRs.mean(axis=0)[10], HRs.mean(axis=0)[15],\n","  File \"/usr/local/lib/python3.7/dist-packages/numpy/core/_methods.py\", line 179, in _mean\n","    ret = umr_sum(arr, axis, dtype, out, keepdims, where=where)\n","KeyboardInterrupt\n"]}],"source":["!python HGDR_solver.py --dataset=Tensorflow --num_core=10 --num_feat_core=10 --sampling_strategy=random  --emb_dim=64 --repr_dim=16  --hidden_size=64 --meta_path_steps=2,2,2,2,2  --init_eval=true --gpu_idx=0 --runs=2 --epochs=30 --batch_size=1024 --save_every_epoch=10 --metapath_test=true --head_tail_test=false --ssl=true --feat_drop=0.2 --tau=0.5  --dropout=0.2  --ssl_coff=0.2 --side_info=true --side_info_vector_size=64 --side_info_window=8 --side_info_min_count=3 --side_info_epoch=8"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"bIXz1c58s_WN"},"outputs":[],"source":[""]}],"metadata":{"accelerator":"GPU","colab":{"collapsed_sections":[],"machine_shape":"hm","name":"developer Recommendation.ipynb（副本）","provenance":[],"authorship_tag":"ABX9TyNLzP/XHbdG17qtEfBubNhX"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}